# 仕様書 (SPECIFICATIONS)

## ファイル命名規則
- **入力ファイル**
    - スライド: `input/{番号}__{タイトル}.md`
    - 台本: `input/{番号}__{タイトル}.txt`
    - `__` (アンダースコア2つ) で番号とタイトルを区切る。
    - 番号が一致するファイルをペアとして扱う。タイトル部分は一致していなくても良い（番号を正とする）。
    - タイトルは空でも良い (例: `020__.md`)。

- **出力ファイル**
    - 音声: `output/{番号}__{タイトル}.wav`
    - 無音動画: `output/{番号}__{タイトル}.nosound.mp4`
    - 結合動画: `output/{番号}__{タイトル}.mp4`
    - **最終成果物**: `output/final_presentation.mp4` (全ての結合動画を番号順に連結したもの)

## 処理フロー
1. `input/` ディレクトリをスキャンし、処理対象のファイルをリストアップする。
2. 各ペアについて以下の処理を行う (番号順):
    - **音声生成**:
        - `.txt` の内容を VOICEVOX API に送信し、音声を生成。
        - `output/` に `.wav` として保存。
    - **動画生成**:
        - `.md` の内容を解析・レンダリングして画像化 (HTML -> Screenshot)。
        - 生成された `.wav` の再生時間を取得。
        - 画像をその時間分表示する動画を作成 (`ffmpeg` loop input)。
        - `output/` に `.nosound.mp4` として保存。
    - **結合**:
        - `.wav` と `.nosound.mp4` を結合。
        - `output/` に `.mp4` として保存。
        - 生成された動画パスをリストに追加。
3. **全結合**:
    - リストに追加された動画を番号順に連結。
    - `output/final_presentation.mp4` として保存。

## エラーハンドリング
- 対応する台本がないスライド: 動画生成をスキップ（またはデフォルト時間で生成するか要検討、現状はスキップ）。
- 対応するスライドがない台本: 音声のみ生成し、動画結合はスキップ。
- 結合する動画がない場合: 最終動画生成をスキップ。
